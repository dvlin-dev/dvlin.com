---
title: 'åˆæ¢ RAG'
description: ''
pubDate: 2024-10-12
lastModDate: ''
toc: true
share: true
ogImage: true
---

# ç†è®º

Retrieval Augmented Generationï¼ˆæ£€ç´¢å¢å¼ºç”Ÿæˆï¼‰
ä»ä¸€ä¸ªå°ç™½çš„è§’åº¦ï¼Œä»ç†è®ºå‡ºå‘ï¼Œä¸€èµ·æ„å»ºä¸€ä¸ªMVP RAG ç³»ç»Ÿï¼Œæœ€è¿‘ä»¥å®æˆ˜ç»“å°¾ï¼Œè®©æˆ‘ä»¬ä¸€èµ·è¸è¿› RAG çš„å¤§é—¨ã€‚

## æ£€ç´¢æµç¨‹

ç®€æ˜“ç‰ˆï¼š
![20241202 202703.716 2](https://dvlin-notes-assets.oss-cn-beijing.aliyuncs.com/2024/12/02/UspLXSvNcmDNkKEPmfF120241202-202703.716-2.jpg)

## ä»€ä¹ˆæ˜¯å‘é‡

å‘é‡æ˜¯ RAG ä¸­æ•°æ®å¬å›çš„åŸºç¡€ï¼Œæˆ‘ä»¬ä»¥ç‹—ğŸ¶ä¸¾ä¾‹ï¼Œæ¥ä¸€èµ·è®¤è¯†ä¸‹ï¼Œä»€ä¹ˆæ˜¯å‘é‡ï¼Ÿ
![img v3 02h6 c9266b9f 8423 4f0c b6e9 46848a5344dg](https://dvlin-notes-assets.oss-cn-beijing.aliyuncs.com/2024/12/02/hGnOMPBQb1kai66dvQC3img_v3_02h6_c9266b9f-8423-4f0c-b6e9-46848a5344dg.png)
æˆ‘ä»¬ä¹‹æ‰€ä»¥èƒ½å¤Ÿåˆ†è¾¨ä¸åŒçš„ç‹—ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬ä¼šä»ä¸åŒçš„è§’åº¦æ¥è§‚å¯Ÿå®ƒçš„ç‰¹å¾ã€‚
ä»¥ä½“å‹ä¸ºæ•°æ®ï¼Œæˆ‘ä»¬å…ˆä»ä¸€ç»´çš„è§’åº¦æ¥åˆ†æï¼š
![img v3 02h6 3e1431a5 76a9 4606 b1b6 61949369342g](https://dvlin-notes-assets.oss-cn-beijing.aliyuncs.com/2024/12/02/BoTPi8PNie8xP0kaOmRyimg_v3_02h6_3e1431a5-76a9-4606-b1b6-61949369342g.png)
æ­¤æ—¶ï¼Œæœ‰ä¸€äº›ç§ç±»æ˜¯é‡å çš„ï¼Œæ­¤æ—¶æˆ‘ä»¬åŠ ä¸€ä¸ªç»´åº¦ï¼šæ¯›é•¿
![img v3 02h6 7c833a99 da97 4ad7 b31d 9dfb18f7136g](https://dvlin-notes-assets.oss-cn-beijing.aliyuncs.com/2024/12/02/cZRjtI7LDz0NFz3raqo5img_v3_02h6_7c833a99-da97-4ad7-b31d-9dfb18f7136g.png)
åœ¨ç‰©ç†ä¸–ç•Œä¸­ï¼Œæˆ‘ä»¬å¾€å¾€ä»¥ä¸‰ç»´åæ ‡è½´æ¥æ ‡è®°æ•°æ®ã€‚
åœ¨å‘é‡ä¸­ï¼Œç»´åº¦å¯ä»¥è¾¾åˆ°ä¸Šåƒç»´ã€‚openai çš„text-embedding-3-largeåˆ™ä¸º 3072ã€‚
åªè¦æˆ‘ä»¬ä¸æ–­æ·»åŠ ç»´åº¦ï¼Œä¸åŒçš„ç‰©ä½“ï¼Œå°±èƒ½æ¸…æ™°çš„åŒºåˆ†å¼€ã€‚
![img v3 02h6 d2113e98 d94a 45f7 b81e 536532cd9ccg](https://dvlin-notes-assets.oss-cn-beijing.aliyuncs.com/2024/12/02/6Pzy6kIjr4m9Fdx36QjQimg_v3_02h6_d2113e98-d94a-45f7-b81e-536532cd9ccg.png)
åŒæ ·ï¼ŒåŒç±»ç‰©ä½“å°±ä¼šèšåœ¨ä¸€èµ·
![img v3 02h6 38082f11 40e4 4792 b6ec 1cd6be8e76bg](https://dvlin-notes-assets.oss-cn-beijing.aliyuncs.com/2024/12/02/4oKbX9KMg24lLTwaVCsgimg_v3_02h6_38082f11-40e4-4792-b6ec-1cd6be8e76bg.png)
æ‹¿åˆ°è¿™äº›æ•°æ®åï¼Œæ€ä¹ˆè®¡ç®—ä¸¤ä¸ªå‘é‡çš„è·ç¦»å‘¢ï¼Ÿ

## ç›¸ä¼¼æ€§æµ‹é‡

### æ¬§å‡ é‡Œå¾—è·ç¦»

æ¬§å‡ é‡Œå¾—è·ç¦»ç®—æ³•çš„ä¼˜ç‚¹æ˜¯å¯ä»¥åæ˜ å‘é‡çš„ç»å¯¹è·ç¦»ï¼Œé€‚ç”¨äºéœ€è¦è€ƒè™‘å‘é‡é•¿åº¦çš„ç›¸ä¼¼æ€§è®¡ç®—ã€‚ä¾‹å¦‚æ¨èç³»ç»Ÿä¸­ï¼Œéœ€è¦æ ¹æ®ç”¨æˆ·çš„å†å²è¡Œä¸ºæ¥æ¨èç›¸ä¼¼çš„å•†å“ï¼Œè¿™æ—¶å°±éœ€è¦è€ƒè™‘ç”¨æˆ·çš„å†å²è¡Œä¸ºçš„æ•°é‡ï¼Œè€Œä¸ä»…ä»…æ˜¯ç”¨æˆ·çš„å†å²è¡Œä¸ºçš„ç›¸ä¼¼åº¦ã€‚

### ä½™å¼¦ç›¸ä¼¼åº¦

ä½™å¼¦ç›¸ä¼¼åº¦å¯¹å‘é‡çš„é•¿åº¦ä¸æ•æ„Ÿï¼Œåªå…³æ³¨å‘é‡çš„æ–¹å‘ï¼Œå› æ­¤é€‚ç”¨äºé«˜ç»´å‘é‡çš„ç›¸ä¼¼æ€§è®¡ç®—ã€‚
ä¾‹å¦‚è¯­ä¹‰æœç´¢å’Œæ–‡æ¡£åˆ†ç±»ã€‚

### ç‚¹ç§¯ç›¸ä¼¼åº¦

ç‚¹ç§¯ç›¸ä¼¼åº¦ç®—æ³•çš„ä¼˜ç‚¹åœ¨äºå®ƒç®€å•æ˜“æ‡‚ï¼Œè®¡ç®—é€Ÿåº¦å¿«ï¼Œå¹¶ä¸”å…¼é¡¾äº†å‘é‡çš„é•¿åº¦å’Œæ–¹å‘ã€‚å®ƒé€‚ç”¨äºè®¸å¤šå®é™…åœºæ™¯ï¼Œä¾‹å¦‚å›¾åƒè¯†åˆ«ã€è¯­ä¹‰æœç´¢å’Œæ–‡æ¡£åˆ†ç±»ç­‰ã€‚ä½†ç‚¹ç§¯ç›¸ä¼¼åº¦ç®—æ³•å¯¹å‘é‡çš„é•¿åº¦æ•æ„Ÿï¼Œå› æ­¤åœ¨è®¡ç®—é«˜ç»´å‘é‡çš„ç›¸ä¼¼æ€§æ—¶å¯èƒ½ä¼šå‡ºç°é—®é¢˜ã€‚

åœ¨å¤§å¤šæ•°è¯­ä¹‰æœç´¢å’Œæ–‡æ¡£åˆ†ç±»ä»»åŠ¡ä¸­ï¼Œä½™å¼¦ç›¸ä¼¼åº¦é€šå¸¸æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚

# å®æˆ˜

## MVP

```ts
import { Configuration, OpenAIApi } from 'openai'
import * as cosineSimilarity from 'cosine-similarity'

// é…ç½®OpenAI API
const configuration = new Configuration({
  apiKey: process.env.OPENAI_API_KEY,
})

const openai = new OpenAIApi(configuration)

// ä½¿ç”¨ OpenAI çš„ text-embedding-3-large æ¨¡å‹æ¥å°†æ–‡æœ¬è½¬ä¸ºå‘é‡
async function getEmbedding(text: string): Promise<number[]> {
  const response = await openai.createEmbedding({
    model: 'text-embedding-3-large',
    input: text,
  })

  const embedding = response.data.data[0].embedding
  return embedding
}

// è®¡ç®—ä¸¤ä¸ªå‘é‡çš„ä½™å¼¦ç›¸ä¼¼åº¦
function calculateCosineSimilarity(vec1: number[], vec2: number[]): number {
  return cosineSimilarity(vec1, vec2)
}

// å°†å¤šä¸ªæ–‡æœ¬è½¬æ¢ä¸ºå‘é‡å¹¶å­˜å‚¨
async function embedTexts(texts: string[]): Promise<number[][]> {
  const embeddings = []
  for (const text of texts) {
    const embedding = await getEmbedding(text)
    embeddings.push(embedding)
  }
  return embeddings
}

// è·å–ä¸é—®é¢˜æœ€ç›¸ä¼¼çš„å‰10æ¡æ–‡æœ¬èµ„æ–™
async function findTopMatches(
  question: string,
  texts: string[],
  embeddings: number[][]
): Promise<string[]> {
  const questionEmbedding = await getEmbedding(question)

  const similarities = embeddings.map((embedding, index) => ({
    text: texts[index],
    similarity: calculateCosineSimilarity(questionEmbedding, embedding),
  }))

  // æŒ‰ç›¸ä¼¼åº¦æ’åºå¹¶è¿”å›å‰10ä¸ª
  similarities.sort((a, b) => b.similarity - a.similarity)

  return similarities.slice(0, 10).map((item) => item.text)
}

// ä¸»é€»è¾‘ï¼šå°†ç”¨æˆ·é—®é¢˜ä¸æ–‡æœ¬èµ„æ–™åŒ¹é…
async function handleUserQuestion(
  question: string,
  texts: string[]
): Promise<string[]> {
  const embeddings = await embedTexts(texts)
  return await findTopMatches(question, texts, embeddings)
}

// ç¤ºä¾‹ä½¿ç”¨
;(async () => {
  const texts = [
    'è¿™æ˜¯å…³äºäººå·¥æ™ºèƒ½çš„èµ„æ–™ã€‚',
    'è¿™æ˜¯å…³äºæœºå™¨å­¦ä¹ çš„èµ„æ–™ã€‚',
    'è¿™æ˜¯å…³äºè‡ªç„¶è¯­è¨€å¤„ç†çš„èµ„æ–™ã€‚',
  ]

  const question = 'ä»€ä¹ˆæ˜¯äººå·¥æ™ºèƒ½ï¼Ÿ'
  const matches = await handleUserQuestion(question, texts)

  console.log('åŒ¹é…åˆ°çš„æ–‡æœ¬èµ„æ–™ï¼š', matches)
})()
```

è¿™æ ·ä¸€ä¸ªæœ€å°çš„ demo å°±è·‘é€šäº†ï¼Œå†å®é™…ç”Ÿäº§ä¸­è¿˜è¦é…åˆæ•°æ®åº“å­˜å‚¨ã€‚ä½œä¸º jserï¼Œæ¨èä¸€äº› js ç›¸å…³æŠ€æœ¯æ ˆï¼š

- Nestjs
- ORM: Prisma, orm ä¸­æœ€æ—©æ”¯æŒå‘é‡ç±»å‹ï¼Œä¸”ç¤¾åŒºæ´»è·ƒåº¦é«˜
- å‘é‡æ•°æ®åº“ï¼šPostgreSQL + PgVectorï¼Œä¸ºæ•°ä¸å¤šçš„ï¼ˆéï¼‰å…³ç³»æ•°æ®åº“æ”¯æŒå‘é‡å­˜å‚¨çš„ï¼Œä¸”æ€§èƒ½å’Œç¤¾åŒºæ´»è·ƒåº¦éƒ½å¯ä»¥ã€‚å½“ç„¶ä½ ä¹Ÿå¯ä»¥ç”¨ä¸€äº›ä¸“é—¨åšå‘é‡çš„æ•°æ®åº“æ–¹æ¡ˆï¼šPineconeã€Milvus ...
  MVP: https://github.com/dvlin-dev/rag-copilot/blob/main/server/src/modules/vector/vector.service.ts

## ä¼˜åŒ–æ–¹å‘

### ä» chunk è§’åº¦

![20241202 3](https://dvlin-notes-assets.oss-cn-beijing.aliyuncs.com/2024/12/02/UyF2e33AmiAG5kXCqfPL20241202-3.jpg)

### æ··åˆæŸ¥è¯¢

claude ä¸Šä¸‹æ–‡æ£€ç´¢èåˆæ–¹æ¡ˆ
ã€Œembedding + è¯æ±‡åŒ¹é…ã€å¬å›å†…å®¹åï¼Œé‡æ–°æ’åå»é‡ã€‚ä»¥æé«˜å¬å›å‡†ç¡®ç‡ã€‚å…·ä½“æ“ä½œå¦‚ä¸‹ï¼š
![20241202 202703.716 4](https://dvlin-notes-assets.oss-cn-beijing.aliyuncs.com/2024/12/02/osjGgBTiFvBQIBQk6BCw20241202-202703.716-4.jpg)

## GraphRAG

ä¸åŒäºå‘é‡ Embedding çš„å½¢å¼ï¼ŒGraph å¯¹äºç»“æ„å¤æ‚ã€ç»å¸¸æ”¹åŠ¨çš„æ•°æ®æ›´å‹å¥½
![20241202 202703.716 1](https://dvlin-notes-assets.oss-cn-beijing.aliyuncs.com/2024/12/02/9WjUbdmVek3jeml0cywV20241202-202703.716-1.jpg)

## åº”ç”¨

1. æ–‡æ¡£æ£€ç´¢: https://www.mendable.ai/
2. ä¸ªäººåŠ©ç†: https://app.me.bot/
3. æ™ºèƒ½å®¢æœ
4. å„ç§å·¥ä½œæµ ...

# å‚è€ƒèµ„æ–™

æ¨èé˜…è¯»ä»¥ä¸‹èµ„æ–™ï¼Œéƒ½æ˜¯ç³»ç»Ÿæ€§çš„è®²è§£

1. [ã€ä¸Šé›†ã€‘å‘é‡æ•°æ®åº“æŠ€æœ¯é‰´èµ](https://www.bilibili.com/video/BV11a4y1c7SW/?vd_source=8cbf3df49bc9bd05e33e78a3420ceca6)
2. ã€ä¸‹é›†ã€‘å‘é‡æ•°æ®åº“æŠ€æœ¯é‰´èµ,https://www.bilibili.com/video/BV1BM4y177Dk/?spm_id_from=333.788.recommend_more_video.-1&vd_source=8cbf3df49bc9bd05e33e78a3420ceca6%5D
3. åŸºäºå¤§è¯­è¨€æ¨¡å‹æ„å»ºçŸ¥è¯†é—®ç­”ç³»ç»Ÿ, https://zhuanlan.zhihu.com/p/627655485
4. LLM+Embeddingæ„å»ºé—®ç­”ç³»ç»Ÿçš„å±€é™æ€§åŠä¼˜åŒ–æ–¹æ¡ˆ, https://zhuanlan.zhihu.com/p/641132245
5. https://twitter.com/Tisoga/status/1731478506465636749?s=20
6. https://twitter.com/dotey/status/1743393585217556991
7. https://github.com/microsoft/graphrag
8. https://docs.mem0.ai/open-source/graph_memory/overview
9. https://x.com/llama_index/status/1796936357966954564
10. https://github.com/dvlin-dev/rag-copilot
11. https://www.anthropic.com/news/contextual-retrieval
